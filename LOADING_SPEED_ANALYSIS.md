# 로딩 속도 저하 원인 분석

## 🔴 현재 문제

로딩 속도가 매우 느려졌습니다.

## 📊 원인 분석

### 1. Vite 설정 변경 (영향 없음)

**변경 사항:**
- `sourcemap: false` - 빌드 속도는 오히려 **빨라짐**
- `minify: "esbuild"` - 기본값과 동일 (영향 없음)

**결론:** Vite 설정은 로딩 속도 저하 원인이 **아닙니다**.

---

### 2. 실제 원인: 서버 측 순차 처리

**문제:**
- `getAllUsersWithMonthlyStats` API가 **순차 처리**로 변경됨
- 27명 사용자를 **한 명씩** 처리
- 각 사용자마다 **2개 쿼리** 실행:
  1. `attendance.count()` - 출석 수 조회
  2. `matchParticipant.findMany()` - 경기 참여 기록 조회

**계산:**
- 총 사용자: 27명
- 각 사용자당 쿼리: 2개
- 총 쿼리 수: **54개**
- 순차 실행: **54개 쿼리를 순차적으로 실행**

**예상 소요 시간:**
- 각 쿼리 평균: 50-100ms
- 54개 쿼리 × 100ms = **5.4초 ~ 10.8초**

---

### 3. 프론트엔드 구조

**현재 구조:**
```javascript
loadDashboardData() {
  // 1. 3개 API 병렬 호출 (빠름)
  await Promise.all([stats, attendance, allMatches]);
  
  // 2. 월별 통계 API 호출 (느림 - 순차 처리)
  await loadRankingData(currentYear, currentMonth);
  
  // 3. 로딩 완료
  setLoading(false);
}
```

**문제:**
- `loadRankingData`가 완료될 때까지 전체 로딩이 대기
- 사용자는 **5-10초 동안** 로딩 화면을 봐야 함

---

## ✅ 해결 방안

### 옵션 1: 병렬 처리로 변경 (권장하지 않음)

**장점:**
- 빠른 응답 시간

**단점:**
- 연결 풀 제한 오류 재발 가능
- Supabase Transaction Mode 제한 초과

### 옵션 2: 로딩 전략 변경 (권장)

**변경 사항:**
1. **초기 로딩**: 개인 통계만 먼저 표시
2. **백그라운드 로딩**: 월별 랭킹은 나중에 로드
3. **점진적 표시**: 랭킹 데이터가 로드되면 표시

**장점:**
- 사용자는 즉시 개인 통계를 볼 수 있음
- 랭킹은 백그라운드에서 로드
- 전체적인 사용자 경험 개선

### 옵션 3: 캐싱 추가

**변경 사항:**
- 월별 통계를 메모리에 캐싱
- 같은 월 요청 시 캐시된 데이터 반환

**장점:**
- 반복 요청 시 빠른 응답
- 서버 부하 감소

---

## 🎯 권장 해결책

**옵션 2 (로딩 전략 변경)**를 권장합니다:

1. 개인 통계는 즉시 표시
2. 월별 랭킹은 별도로 로드 (로딩 인디케이터 표시)
3. 사용자 경험 개선

---

## 📝 현재 상황 요약

| 항목 | 이전 | 현재 | 차이 |
|------|------|------|------|
| 처리 방식 | 병렬 (Promise.all) | 순차 (for...of) | 27배 느림 |
| 예상 시간 | 0.5-1초 | 5-10초 | 10배 증가 |
| 연결 풀 오류 | 발생 | 해결됨 | ✅ |
| 사용자 경험 | 빠름 | 느림 | ❌ |

**트레이드오프:**
- ✅ 연결 풀 제한 문제 해결
- ❌ 로딩 속도 저하


