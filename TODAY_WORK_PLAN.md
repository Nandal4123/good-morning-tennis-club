# 오늘 작업 계획 (2024-12-19)

## 🎯 목표
**멀티테넌트 기능을 이용한 완전한 클럽 관리 앱 완성**

---

## 📋 작업 순서 및 상세 내용

### 1단계: 데이터 복구 (최우선) ⚠️

#### 작업 내용
- Render Shell에서 스냅샷 파일을 사용하여 데이터베이스 복구
- 복구된 데이터 검증 및 확인

#### 실행 명령
```bash
# Render Shell에서 실행
pwd  # 현재 위치 확인
pnpm run db:restore-snapshot -- --yes
```

#### 완료 후 확인
```bash
# 클럽 목록 확인
pnpm run db:check-clubs

# 데이터베이스 상태 확인
pnpm run db:check-schema
```

#### 완료 후 생기는 기능
- ✅ **모든 클럽 데이터 복구**
  - Good Morning Club 데이터 복구
  - Ace Club 데이터 복구
  - 모든 회원, 세션, 경기, 출석 기록 복구
- ✅ **기존 기능 정상 작동**
  - 회원 관리 기능
  - 출석 체크 기능
  - 경기 기록 기능
  - 통계 및 랭킹 기능

---

### 2단계: 데이터베이스 마이그레이션 🔧

#### 작업 내용
- Prisma 스키마 변경사항을 데이터베이스에 적용
- `clubs` 테이블에 `adminPasswordHash`, `joinCodeHash` 컬럼 추가

#### 실행 명령
```bash
# Render Shell에서 실행
pnpm prisma db push
```

#### 완료 후 확인
```bash
# 스키마 확인
pnpm run db:check-schema

# Prisma Client 재생성
pnpm run db:generate
```

#### 완료 후 생기는 기능
- ✅ **클럽별 관리자 비밀번호 저장 가능**
  - 각 클럽이 독립적인 관리자 비밀번호를 가질 수 있음
  - 비밀번호는 해시화되어 안전하게 저장
- ✅ **클럽별 가입 코드 저장 가능**
  - 각 클럽이 독립적인 가입 코드를 가질 수 있음
  - 가입 코드도 해시화되어 안전하게 저장
- ✅ **Owner 대시보드에서 클럽 설정 관리 가능**
  - 클럽 생성 시 관리자 비밀번호/가입 코드 설정
  - 기존 클럽의 비밀번호/가입 코드 변경

---

### 3단계: Owner 대시보드 기능 테스트 🧪

#### 작업 내용
- 모든 Owner 대시보드 기능이 정상 작동하는지 테스트
- 각 기능의 UI/UX 확인 및 버그 수정

#### 테스트 항목
1. **클럽 추가 기능**
   - 새 클럽 생성
   - 클럽 이름, 서브도메인 입력
   - 관리자 비밀번호, 가입 코드 설정

2. **관리자 비밀번호 관리**
   - 비밀번호 설정
   - 비밀번호 변경
   - 비밀번호 표시/숨김 토글

3. **가입 코드 관리**
   - 가입 코드 설정
   - 가입 코드 변경
   - 가입 코드 표시/숨김 토글

4. **클럽 현황 확인**
   - 클럽 목록 표시
   - 클럽 선택 시 상세 정보 표시
   - 통계 정보 표시 (회원 수, 세션 수, 경기 수, 출석 기록 수)

#### 완료 후 생기는 기능
- ✅ **완전한 클럽 관리 시스템**
  - Owner가 하나의 대시보드에서 모든 클럽을 관리
  - 클럽 추가/수정/삭제 (예정) 가능
  - 각 클럽의 설정을 독립적으로 관리

- ✅ **직관적인 관리 인터페이스**
  - 클럽 목록 검색 기능
  - 클럽별 상세 정보 한눈에 확인
  - 클럽으로 바로 이동하는 버튼
  - 새 탭에서 클럽 열기 기능

- ✅ **안전한 비밀번호 관리**
  - 비밀번호는 해시화되어 저장
  - 비밀번호 표시/숨김 토글로 편리한 관리
  - 최소 4자 이상 검증

---

### 4단계: 멀티테넌트 기능 강화 🔒

#### 작업 내용
- 각 클럽의 데이터가 완전히 독립적으로 관리되는지 확인
- 클럽 간 데이터 격리 검증
- 기본 클럽의 레거시 데이터 호환성 확인

#### 확인 항목
1. **데이터 격리 확인**
   - Good Morning Club 회원이 Ace Club 데이터에 접근 불가
   - Ace Club 회원이 Good Morning Club 데이터에 접근 불가
   - 각 클럽의 세션, 경기, 출석 데이터가 독립적인지 확인

2. **레거시 데이터 호환성**
   - `clubId=NULL` 데이터가 Good Morning Club에서 표시되는지 확인
   - `clubId=NULL` 데이터가 Ace Club에서 표시되지 않는지 확인

#### 완료 후 생기는 기능
- ✅ **완벽한 데이터 격리**
  - 각 클럽의 데이터가 완전히 독립적으로 관리
  - 클럽 간 데이터 접근 불가
  - 데이터 보안 강화

- ✅ **레거시 데이터 호환**
  - 과거 데이터(`clubId=NULL`)가 기본 클럽에서 정상 표시
  - 기존 사용자에게 영향 없음
  - 점진적 마이그레이션 가능

---

### 5단계: 추가 기능 구현 (선택) 🚀

#### 작업 내용
- 클럽 관리 기능 확장
- 통계 대시보드 확장
- 사용자 관리 기능 추가

#### 구현 예정 기능
1. **클럽 삭제 기능**
   - ⚠️ 주의: 데이터 보존 정책 필요
   - 소프트 삭제 (soft delete) 고려
   - 삭제 전 경고 및 확인 절차

2. **클럽 통계 대시보드 확장**
   - 월별 통계 그래프
   - 회원 활동 추이
   - 경기 통계 상세 정보

3. **클럽 설정 관리**
   - 클럽 이름 변경
   - 서브도메인 변경 (주의: URL 변경 영향)
   - 클럽 설명 추가

4. **클럽별 사용자 관리**
   - 클럽별 회원 목록 조회
   - 클럽별 회원 통계
   - 클럽 간 회원 이동 (고급 기능)

#### 완료 후 생기는 기능
- ✅ **완전한 클럽 관리 시스템**
  - 클럽 생성/수정/삭제
  - 클럽별 상세 설정 관리
  - 클럽별 통계 및 분석

- ✅ **확장 가능한 구조**
  - 무제한 클럽 추가 가능
  - 각 클럽이 독립적으로 운영
  - 클럽별 커스터마이징 가능

---

## 🎉 작업 완료 후 최종 기능

### Owner 대시보드 기능
1. **클럽 목록 관리**
   - 모든 클럽 목록 표시
   - 클럽 검색 기능
   - 클럽 선택 및 상세 정보 확인

2. **클럽 생성**
   - 새 클럽 추가
   - 클럽 이름, 서브도메인 설정
   - 관리자 비밀번호, 가입 코드 초기 설정

3. **클럽 설정 관리**
   - 관리자 비밀번호 설정/변경
   - 가입 코드 설정/변경
   - 클럽 정보 확인 (생성일, 통계)

4. **클럽 이동**
   - 클럽 선택 후 해당 클럽으로 이동
   - 새 탭에서 클럽 열기

### 멀티테넌트 기능
1. **완전한 데이터 격리**
   - 각 클럽의 데이터가 독립적으로 관리
   - 클럽 간 데이터 접근 불가

2. **레거시 데이터 호환**
   - 과거 데이터(`clubId=NULL`)가 기본 클럽에서 정상 작동
   - 기존 사용자에게 영향 없음

3. **확장 가능한 구조**
   - 무제한 클럽 추가 가능
   - 각 클럽이 독립적으로 운영

### 사용자 경험
1. **직관적인 인터페이스**
   - 깔끔한 UI/UX
   - 명확한 기능 구분
   - 쉬운 클럽 관리

2. **안전한 관리**
   - 비밀번호 해시화 저장
   - 가입 코드 해시화 저장
   - 데이터 보안 강화

---

## 📊 작업 완료 후 시스템 구조

```
Owner 대시보드
├── 클럽 목록
│   ├── 검색 기능
│   ├── 클럽 선택
│   └── 클럽 이동
├── 클럽 생성
│   ├── 기본 정보 입력
│   ├── 관리자 비밀번호 설정
│   └── 가입 코드 설정
└── 클럽 설정
    ├── 관리자 비밀번호 변경
    ├── 가입 코드 변경
    └── 클럽 통계 확인

각 클럽 (독립 운영)
├── 회원 관리
├── 출석 관리
├── 경기 기록
└── 통계 및 랭킹
```

---

## ⚠️ 주의사항

1. **데이터 복구는 파괴적 작업**
   - 기존 데이터베이스의 모든 데이터가 삭제됨
   - 스냅샷 이후 생성된 데이터는 손실됨

2. **마이그레이션은 신중하게**
   - 데이터베이스 스키마 변경은 되돌릴 수 없음
   - 마이그레이션 전 백업 권장

3. **테스트는 철저하게**
   - 각 기능을 개별적으로 테스트
   - 데이터 격리가 제대로 작동하는지 확인

---

## 📝 체크리스트

- [ ] 1단계: 데이터 복구
- [ ] 2단계: 데이터베이스 마이그레이션
- [ ] 3단계: Owner 대시보드 기능 테스트
- [ ] 4단계: 멀티테넌트 기능 강화
- [ ] 5단계: 추가 기능 구현 (선택)

---

## 🚀 다음 단계

모든 작업이 완료되면:
1. ✅ 완전한 멀티테넌트 클럽 관리 시스템 완성
2. ✅ Owner가 하나의 대시보드에서 모든 클럽 관리 가능
3. ✅ 각 클럽이 독립적으로 운영 가능
4. ✅ 확장 가능한 구조로 무제한 클럽 추가 가능



