# 이메일 → 전화번호 변경 진단 보고서

## 📋 개요

가입 시 이메일 대신 전화번호를 사용하도록 변경하는 것에 대한 종합적인 진단 및 영향 분석입니다.

## 🔍 현재 이메일 사용 현황

### 1. 데이터베이스 스키마
- **위치**: `server/prisma/schema.prisma`
- **현재 상태**:
  ```prisma
  model User {
    email String @unique  // 고유 식별자로 사용
    ...
  }
  ```
- **영향도**: ⚠️ **매우 높음** - 데이터베이스 스키마 변경 필요

### 2. 회원가입 폼
- **위치**: `client/src/pages/Login.jsx` (라인 389-403)
- **현재 상태**: `type="email"` 필수 입력 필드
- **영향도**: ⚠️ **높음** - UI 및 유효성 검사 변경 필요

### 3. Owner 식별
- **위치**: `client/src/pages/Login.jsx` (라인 17, 258)
- **현재 상태**: 
  ```javascript
  const OWNER_EMAIL = "nandal4123@gmail.com";
  const isOwner = selectedAdminUser?.email === OWNER_EMAIL;
  ```
- **영향도**: ⚠️ **높음** - Owner 식별 로직 변경 필요

### 4. Guest 사용자 식별
- **위치**: 여러 파일 (`Members.jsx`, `Attendance.jsx`, `Dashboard.jsx`)
- **현재 상태**: `user.email?.endsWith("@guest.local")`로 게스트 식별
- **영향도**: ⚠️ **중간** - 게스트 식별 방법 변경 필요

### 5. UI 표시
- **위치**: 
  - `Layout.jsx` (라인 172): 사이드바에 이메일 표시
  - `Members.jsx` (라인 703): 회원 목록에 이메일 표시
  - `MemberCard.jsx` (라인 80): 회원 카드에 이메일 표시
  - `Attendance.jsx` (라인 121): 출석 목록에 이메일 표시
  - `Profile.jsx` (라인 12, 97): 프로필에 이메일 표시
- **영향도**: ⚠️ **중간** - 모든 UI에서 이메일 → 전화번호로 변경

### 6. 검색 기능
- **위치**: `client/src/pages/Members.jsx` (라인 363)
- **현재 상태**: 이메일로도 검색 가능
- **영향도**: ⚠️ **낮음** - 검색 로직에 전화번호 추가

### 7. 서버 API
- **위치**: `server/src/controllers/userController.js`
- **현재 상태**: 
  - `createUser`: email 필수
  - `updateUser`: email 업데이트 가능
  - 중복 체크: `P2002` 에러 (Email already exists)
- **영향도**: ⚠️ **높음** - API 로직 변경 필요

## ✅ 전화번호로 변경 시 장점

### 1. 사용자 경험
- ✅ **더 실용적**: 한국 사용자에게 전화번호가 더 친숙함
- ✅ **입력 편의성**: 이메일 형식 검증 불필요 (단, 전화번호 형식 검증은 필요)
- ✅ **개인정보**: 이메일보다 전화번호가 덜 민감할 수 있음 (상황에 따라 다름)

### 2. 기능적 이점
- ✅ **SMS 연동 가능**: 향후 SMS 알림 기능 추가 용이
- ✅ **실명 확인**: 전화번호 인증으로 실명 확인 가능

## ⚠️ 전화번호로 변경 시 단점 및 고려사항

### 1. 기술적 복잡도

#### 데이터베이스 마이그레이션
- ⚠️ **기존 데이터 마이그레이션**: 모든 사용자의 이메일을 전화번호로 변환해야 함
- ⚠️ **Unique 제약조건**: `email @unique` → `phone @unique`로 변경
- ⚠️ **인덱스 재생성**: 데이터베이스 인덱스 재구성 필요

#### 전화번호 형식
- ⚠️ **국가별 형식**: 한국(010-1234-5678), 해외(+82-10-1234-5678) 등 다양한 형식
- ⚠️ **검증 로직**: 정규식으로 전화번호 형식 검증 필요
- ⚠️ **저장 형식**: 하이픈 포함/제외, 국가 코드 포함/제외 등 통일 필요

### 2. 기능적 제약

#### Owner 식별
- ⚠️ **하드코딩된 이메일**: `OWNER_EMAIL = "nandal4123@gmail.com"`를 전화번호로 변경
- ⚠️ **대안 필요**: Owner 식별을 위한 다른 방법 고려 (예: 특별한 전화번호, 별도 플래그)

#### Guest 사용자
- ⚠️ **식별 방법 변경**: `@guest.local` 패턴 사용 불가
- ⚠️ **대안 필요**: Guest 사용자 식별을 위한 다른 방법 (예: `phone`이 null이거나 특정 패턴)

### 3. 보안 및 개인정보

#### 개인정보 보호
- ⚠️ **민감 정보**: 전화번호는 개인정보보호법상 민감정보로 분류될 수 있음
- ⚠️ **암호화**: 전화번호 저장 시 암호화 고려 필요

#### 중복 방지
- ⚠️ **전화번호 변경**: 사용자가 전화번호를 변경하면 기존 계정과 충돌 가능
- ⚠️ **휴대폰 번호 이전**: 통신사 변경 시 전화번호 재사용 가능

## 🔧 변경 시 필요한 작업

### 1. 데이터베이스 스키마 변경
```prisma
model User {
  id              String      @id @default(cuid())
  phone           String?     @unique  // email → phone으로 변경, 옵셔널로 시작
  email           String?     // 기존 이메일 유지 (마이그레이션 기간 동안)
  name            String
  ...
}
```

### 2. 마이그레이션 전략
- **단계적 마이그레이션**: 
  1. `phone` 필드 추가 (옵셔널)
  2. 기존 사용자 데이터 마이그레이션
  3. 새 사용자는 전화번호만 입력
  4. `email` 필드 제거

### 3. 코드 변경 범위

#### 프론트엔드
- [ ] `Login.jsx`: 회원가입 폼 (이메일 → 전화번호)
- [ ] `Login.jsx`: Owner 식별 로직 (`OWNER_EMAIL` → `OWNER_PHONE`)
- [ ] `Members.jsx`: Guest 사용자 식별 로직
- [ ] `Members.jsx`: 검색 기능 (전화번호 포함)
- [ ] `Layout.jsx`: 사이드바 표시
- [ ] `MemberCard.jsx`: 회원 카드 표시
- [ ] `Attendance.jsx`: 출석 목록 표시
- [ ] `Profile.jsx`: 프로필 표시 및 수정

#### 백엔드
- [ ] `schema.prisma`: 스키마 변경
- [ ] `userController.js`: `createUser` (전화번호 검증)
- [ ] `userController.js`: `updateUser` (전화번호 업데이트)
- [ ] `userController.js`: 중복 체크 로직

### 4. 전화번호 검증 로직
```javascript
// 한국 전화번호 형식 검증 예시
const validatePhoneNumber = (phone) => {
  // 010-1234-5678 형식
  const koreanPhoneRegex = /^010-\d{4}-\d{4}$/;
  // 01012345678 형식 (하이픈 없음)
  const koreanPhoneNoDashRegex = /^010\d{8}$/;
  // +82-10-1234-5678 형식 (국제 형식)
  const internationalRegex = /^\+82-10-\d{4}-\d{4}$/;
  
  return koreanPhoneRegex.test(phone) || 
         koreanPhoneNoDashRegex.test(phone) || 
         internationalRegex.test(phone);
};

// 정규화: 모든 전화번호를 통일된 형식으로 저장
const normalizePhoneNumber = (phone) => {
  // 하이픈 제거 후 010-XXXX-XXXX 형식으로 변환
  const cleaned = phone.replace(/[-\s]/g, '');
  if (cleaned.startsWith('010') && cleaned.length === 11) {
    return `${cleaned.slice(0, 3)}-${cleaned.slice(3, 7)}-${cleaned.slice(7)}`;
  }
  return phone;
};
```

## 📊 변경 영향도 요약

| 항목 | 영향도 | 작업 시간 예상 | 난이도 |
|------|--------|----------------|--------|
| 데이터베이스 스키마 | ⚠️ 매우 높음 | 2-3시간 | 중간 |
| 회원가입 폼 | ⚠️ 높음 | 1-2시간 | 낮음 |
| Owner 식별 | ⚠️ 높음 | 30분 | 낮음 |
| Guest 사용자 식별 | ⚠️ 중간 | 1시간 | 낮음 |
| UI 표시 (5개 파일) | ⚠️ 중간 | 2-3시간 | 낮음 |
| 검색 기능 | ⚠️ 낮음 | 30분 | 낮음 |
| 서버 API | ⚠️ 높음 | 2-3시간 | 중간 |
| 전화번호 검증 | ⚠️ 중간 | 1-2시간 | 중간 |
| 데이터 마이그레이션 | ⚠️ 매우 높음 | 3-4시간 | 높음 |
| **총계** | - | **12-18시간** | **중간-높음** |

## 💡 권장사항

### 옵션 1: 이메일과 전화번호 모두 지원 (권장)
- **장점**: 
  - 기존 사용자 영향 최소화
  - 사용자 선택권 제공
  - 점진적 마이그레이션 가능
- **단점**: 
  - 두 필드 모두 관리 필요
  - 중복 체크 로직 복잡

### 옵션 2: 전화번호만 사용
- **장점**: 
  - 단순한 구조
  - 명확한 정책
- **단점**: 
  - 기존 사용자 데이터 마이그레이션 필요
  - 이메일 기반 기능 제거 필요

### 옵션 3: 전화번호를 필수, 이메일을 선택으로
- **장점**: 
  - 전화번호 중심이면서 이메일도 활용 가능
  - 향후 이메일 알림 기능 추가 용이
- **단점**: 
  - 두 필드 모두 관리 필요

## 🎯 최종 의견

### 전화번호로 변경하는 것이 좋은 경우
- ✅ 사용자 대부분이 한국인이고 전화번호를 선호하는 경우
- ✅ SMS 알림 기능을 추가할 계획이 있는 경우
- ✅ 실명 확인이 중요한 경우

### 이메일을 유지하는 것이 좋은 경우
- ✅ 해외 사용자도 고려하는 경우
- ✅ 이메일 기반 알림 기능을 사용하는 경우
- ✅ 기존 사용자 데이터 마이그레이션이 어려운 경우

### 추천: 옵션 3 (전화번호 필수 + 이메일 선택)
- 전화번호를 주 식별자로 사용하되, 이메일도 선택적으로 받기
- 기존 사용자는 이메일 유지, 새 사용자는 전화번호 필수
- 점진적으로 전화번호 중심으로 전환

## 📝 다음 단계

변경을 진행한다면:
1. **데이터베이스 백업** (필수)
2. **스키마 변경 및 마이그레이션 스크립트 작성**
3. **전화번호 검증 로직 구현**
4. **프론트엔드 UI 변경**
5. **백엔드 API 변경**
6. **테스트**: 기존 사용자 데이터 마이그레이션 테스트
7. **배포**: 단계적 배포 (스테이징 → 프로덕션)

